
# websocket-tunnel


### Examples

#### bin/brain to run on brain

`LOG_LEVEL=trace LOG_COMPONENTS=websocket-tunnel bin/brain`

* connectes to tunnel server
* provides webcontent content on /
* see `config/brain.js`


#### bin/cloud

`LOG_LEVEL=trace LOG_COMPONENTS=websocket-tunnel bin/cloud`

* runs the tunnel server
* emits tunnel lifecycle events

#### bin/proxy

`LOG_LEVEL=trace LOG_COMPONENTS=tunnel-proxy bin/proxy`

* subscribes to tunnel lifecycle events from `bin/cloud`
* creates proxy route entries which direct traffic to specific tunnels by hostname (firstpart.)

For convenience it prints the hostname for each tunnel route as it's created:

eg.

PROXYURL brain-id.127.0.0.1.xip.io:9090



### Overview

This module contains __both__ the client and server websocket tunnel functionality, as well as the proxying functionality.

Tunnels are initiated with `.createClient()` and `.createServer()`.


__TODO__ `stopClient()`, `stopServer()` including for mesh.stop()


### Server Usage

#### Starting server with mesh start

Call `createServer(opts)` as the component's startMethod to start a tunnel server when the mesh starts.
See also `createServers(optsArray)` to start multiple tunnel servers.

```javascript
meshConfig = {
  ...
  components: {
    'websocket-tunnel': {
      startMethod: 'createServer',
      schema: {
        'createServer': {
          parameters: [
            {
              name: 'opts'
              value: {

                // See: lib/index.js.ServerOptions class for full list 
                //      of starting options.

                forwardingHostname: '0.0.0.0',
                wshostname: 'tunnel-controller.cloud.com',
                wsport: 10000,

              } 
            }
          ]
        }
      }
    }
  },
  ...
}
```

#### Starting server after mesh start

```javascripts
meshConfig = {
  ...
  components: {
    'websocket-tunnel': {}
  },
  ...
}
```
```javascript
$happn.exchange['websocket-tunnel'].createServer({/* opts */}, function(e, server) {
});
```

### Client Usage

Call `createClient(opts)` as component startMethod or from `$happn.exchange`. See lib/index.js.ClientOptions


